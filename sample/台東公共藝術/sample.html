<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>測試定位</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="dist/style.min.css?v=1.0.2" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        var currentLocation;

        function onClickLocation() {
            console.log(currentLocation.latlng.lat);
            //做到這裡，顯示現在位置
            alert('您所在的位置經緯度' + currentLocation.latlng.lat + ',' + currentLocation.latlng.lng);
        }
    </script>
    <!-- Google Tag Manager-->
    <!-- <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", "GTM-PGQ9WQT");


    </script> -->
</head>

<body>
    <!-- Google Tag Manager (noscript)-->
    <!-- <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PGQ9WQT" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript> -->
    <div class="container">
        <div class="row">
            <div class="col pt-5 text-center">
                <!-- <h1>Leaflet.js 移動中心點、抓目前地點</h1> -->
                <!-- <h6>筆記文：<a href="https://letswrite.tw/leaflet-osm-basic/">Let's Write</a></h6> -->
            </div>
        </div>
        <hr />
        <div class="row mb-3">
            <div class="col">
                <div class="d-flex align-items-center">
                    <p class="mb-0">移動到指定座標：</p>
                    <a class="js-panto m-1 btn btn-sm btn-outline-primary" href="#" data-to="22.76475, 121.1503">台東美術館</a>
                    <a class="js-panto m-1 btn btn-sm btn-outline-primary" href="#" data-to="22.79259, 121.12333">台東火車站</a>
                    <div class="form-check form-switch mr-2 ml-3" style="visibility: hidden;">
                        <input class="form-check-input" id="flyTo" type="checkbox" />
                        <label class="form-check-label" for="flyTo">縮放效果</label>
                    </div>
                </div>
                <!-- <div>
                    規劃路徑
                    <a class="m-1 btn btn-sm btn-outline-primary" href="https://www.openstreetmap.org/directions?from=22.76475, 121.1503&to=22.75321437727234, 121.16465302702785" target="_blank">台東美術館>國際地標</a>
                </div> -->
                <div>
                    <button onclick="onClickLocation();">取得目前座標</button>
                    <button onclick="onClickMoveCurrentLocation();">移動到目前座標</button>
                </div>
                <!-- <div class="d-flex align-items-center">
                    <p class="mb-0">移動 x, y 位置：</p><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="1">x: 50, y: 50</a><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="2">x: 100, y: 100</a><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="3">x: 150, y: 150</a>
                </div> -->
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="map"></div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script type="text/javascript">
        var e = L.map("map", { attributionControl: !0, zoomControl: !0 });
        //固定取得自己的座標
        document.addEventListener("DOMContentLoaded", function () {
            var t = [24.9983469, 121.5810358];
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(e);
            var o = L.icon({ iconUrl: "https://letswritetw.github.io/letswrite-leaflet-osm-locate/dist/dot.svg", iconSize: [16, 16] }),
                n = L.marker(t, { icon: o, title: "跟 <a> 的 title 一樣", opacity: 1 }).addTo(e);

            function a(t) {
                var e = document.querySelectorAll(".js-panto");
                Array.prototype.forEach.call(e, function (e) {
                    e.addEventListener("click", function (e) {
                        e.preventDefault();
                        var o = e.target.dataset.to.split(","),
                            n = e.target.textContent,
                            a = document.getElementById("flyTo").checked;
                        L.popup().setLatLng(o).setContent("".concat(n)).openOn(t), a ? t.flyTo(o) : t.panTo(o);
                    });
                });
            }

            function c(t) {
                var e = document.querySelectorAll(".js-panby");
                Array.prototype.forEach.call(e, function (e) {
                    e.addEventListener("click", function (e) {
                        e.preventDefault();
                        var o = 50 * e.target.dataset.times,
                            n = [o, o];
                        t.panBy(n);
                    });
                });
            }

            e.locate({ setView: !0, watch: false, maxZoom: 18, enableHighAccuracy: !0 }),
                e.on("locationerror", function (o) {
                    console.log("e", o), window.alert("無法判斷您的所在位置，無法使用此功能。預設地點將為 台北市動物園"), e.setView(t, 18), a(e), c(e);
                }),
                e.on("locationfound", function (t) {

                    // alert('您所在的位置經緯度' + t.latlng.lat + ',' + t.latlng.lng);
                    // console.log(t.latlng.lat);
                    // console.log(t.latlng.lng);
                    console.log("e", t), n.setLatLng(t.latlng), a(e), c(e);
                    currentLocation = t;
                });


            //台東美術館22.76475, 121.1503
            //國際地標22.75321437727234, 121.16465302702785
            //台東火車站22.79259,121.12333
            //增加marker
            var center = [22.79259, 121.12333];
            var marker = L.marker(center, {
                title: '台東火車站', // 跟 <a> 的 title 一樣
                opacity: 1.0
            }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/362/medium_20211110091829099.jpg'><label>台東火車站</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/362\");'>詳細</button>").openPopup();



            //center = [22.76475, 121.1503];
            //marker = L.marker(center, {
            //    title: '從目前位置導航到台東美術館', // 跟 <a> 的 title 一樣
            //    opacity: 1.0
            //}).addTo(e);
            //marker.bindPopup("<button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button>").openPopup();


            var title = '';
            //2019
            var icon2019 = L.icon({
                iconUrl: 'https://cdn-icons-png.flaticon.com/512/727/727606.png',
                iconSize: [41, 41]
            });
   
            title = '旅行在50步的空間';
            center = [23.0204200, 121.3249706];
            marker = L.marker(center, { icon: icon2019, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/214/small_20210313064726938.jpg'><label>"+title+"</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/214\");'>詳細</button>").openPopup();

            title = '振興壁畫 阿美族傳說–10個太陽';
            center = [23.0426588, 121.1949693];
            marker = L.marker(center, { icon: icon2019, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/229/small_20210313081813805.JPG'><label>"+title+"</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/229\");'>詳細</button>").openPopup();

            title = '斗笠';
            center = [23.095513, 121.218334];
            marker = L.marker(center, { icon: icon2019, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/230/small_20210313082152166.JPG'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/230\");'>詳細</button>").openPopup();

            title = '在河之間';
            center = [23.107131, 121.193461];
            marker = L.marker(center, { icon: icon2019, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/231/small_20210313082304774.JPG'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/231\");'>詳細</button>").openPopup();

            title = '自然療癒';
            center = [23.095482, 121.215681];
            marker = L.marker(center, { icon: icon2019, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/232/small_20210313082407422.JPG'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/232\");'>詳細</button>").openPopup();


            //2020
            var icon2020 = L.icon({
                iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
                iconSize: [41, 41]
            });

            title = '我想要有個家';
            center = [23.12002654980241, 121.22403659769508];
            marker = L.marker(center, { icon: icon2020, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/348/small_20211111094438072.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/348\");'>詳細</button>").openPopup();

            title = '何時';
            center = [23.120141784214837, 121.22429456385626];
            marker = L.marker(center, { icon: icon2020, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/349/small_20211111092908148.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/349\");'>詳細</button>").openPopup();

            title = '溯土Revert to Earth';
            center = [23.12474819805779, 121.21972271520636];
            marker = L.marker(center, { icon: icon2020, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/350/small_20211110151306000.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/350\");'>詳細</button>").openPopup();

            title = '拾火Kalo’orip';
            center = [23.12497996526222, 121.21940008914386];
            marker = L.marker(center, { icon: icon2020, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/351/small_20211110150929837.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/351\");'>詳細</button>").openPopup();

            title = '供給與需求';
            center = [23.125048568251945, 121.21941766460687];
            marker = L.marker(center, { icon: icon2020, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/352/small_20211110150648084.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/352\");'>詳細</button>").openPopup();

            //2021
            var icon2021 = L.icon({
                iconUrl:'https://cdn-icons-png.flaticon.com/512/6317/6317800.png',
                iconSize: [41, 41]
            });

            title = '療癒系列';
            center = [23.041170000332418, 121.17641641622309];
            marker = L.marker(center, { icon: icon2021, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/357/small_20211110101729813.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/357\");'>詳細</button>").openPopup();

            title = '蛻變前的等待';
            center = [23.04408477348909, 121.17730567378085];
            marker = L.marker(center, { icon: icon2021, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/358/small_20211110101343066.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/358\");'>詳細</button>").openPopup();

            title = '雲朵製造所';
            center = [23.040585419463223, 121.17430410742662];
            marker = L.marker(center, { icon: icon2021, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/359/small_20211110101131334.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/359\");'>詳細</button>").openPopup();

            title = '穹頂上有花';
            center = [22.939326565363256, 121.15198768782173];
            marker = L.marker(center, { icon: icon2021, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/360/small_20211110100819622.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/360\");'>詳細</button>").openPopup();

            title = '粉紅河馬';
            center = [22.931328602371874, 121.15613336862421];
            marker = L.marker(center, { icon: icon2021, title: title, opacity: 1.0 }).addTo(e);
            marker.bindPopup("<div><img width='200' src='https://tpa.ccl.ttct.edu.tw/download/arts_upload_file/361/small_20211110100557628.jpg'><label>" + title + "</label><div><button onclick='onClickMarker導航(" + center[0] + ", " + center[1] + ")'>導航</button> <button onclick='onClickDetail(\"https://tpa.ccl.ttct.edu.tw/Arts/Details/361\");'>詳細</button>").openPopup();

        });

        function onClickMarker導航(To經度, To緯度) {
            window.open(get路經規劃網址(currentLocation.latlng.lat, currentLocation.latlng.lng, To經度, To緯度), '_blank');
        }

        function onClickDetail(url) {
            window.open(url,'_blank');
        }


        function get路經規劃網址(From經度, From緯度, To經度, To緯度) {
            return "https://www.openstreetmap.org/directions?from=" + From經度 + ", " + From緯度 + "&to=" + To經度 + ", " + To緯度 + "";
        }

        function onClickMoveCurrentLocation() {
            e.flyTo([currentLocation.latlng.lat, currentLocation.latlng.lng]);
        }

        $(function () {
            // var map = L.map("map");


        });
    </script>
</body>

</html>