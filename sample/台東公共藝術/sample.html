<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>測試定位</title>
    <link rel="canonical" href="https://letswrite.tw/leaflet-osm-locate/" />
    <meta property="og:url" content="https://letswritetw.github.io/letswrite-leaflet-osm-locate/" />
    <meta property="fb:app_id" content="911000986339138" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Let's Write" />
    <meta property="og:title" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點 - Augustus - Let's Write" />
    <meta itemprop="name" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點 - Augustus - Let's Write" />
    <meta name="description" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點" />
    <meta property="og:description" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點" />
    <meta itemprop="description" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點" />
    <meta itemprop="image" content="https://letswritetw.github.io/letswrite-leaflet-osm-locate/fb.jpg?v=1.0.2" />
    <meta property="og:image" content="https://letswritetw.github.io/letswrite-leaflet-osm-locate/fb.jpg?v=1.0.2" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="OSM + Leaflet 學習筆記2：移動中心點、抓目前地點" />
    <link rel="shortcut icon" href="https://letswritetw.github.io/letswritetw/dist/img/logo_512.png" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="dist/style.min.css?v=1.0.2" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
    var currentLocation;

    function onClickLocation() {
        console.log(currentLocation.latlng.lat);
        //做到這裡，顯示現在位置
        alert('您所在的位置經緯度' + currentLocation.latlng.lat + ',' + currentLocation.latlng.lng);
    }
    </script>
    <!-- Google Tag Manager-->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", "GTM-PGQ9WQT");


    </script>
</head>

<body>
    <!-- Google Tag Manager (noscript)-->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PGQ9WQT" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <div class="container">
        <div class="row">
            <div class="col pt-5 text-center">
                <!-- <h1>Leaflet.js 移動中心點、抓目前地點</h1> -->
                <!-- <h6>筆記文：<a href="https://letswrite.tw/leaflet-osm-basic/">Let's Write</a></h6> -->
            </div>
        </div>
        <hr />
        <div class="row mb-3">
            <div class="col">
                <div class="d-flex align-items-center">
                    <p class="mb-0">移動到指定座標：</p>
                    <a class="js-panto m-1 btn btn-sm btn-outline-primary" href="#" data-to="22.76475, 121.1503">台東美術館</a>
                    <a class="js-panto m-1 btn btn-sm btn-outline-primary" href="#" data-to="22.79259, 121.12333">台東火車站</a>
                    <div class="form-check form-switch mr-2 ml-3" style="visibility: hidden;">
                        <input class="form-check-input" id="flyTo" type="checkbox" />
                        <label class="form-check-label" for="flyTo">縮放效果</label>
                    </div>
                </div>
                <!-- <div>
                    規劃路徑
                    <a class="m-1 btn btn-sm btn-outline-primary" href="https://www.openstreetmap.org/directions?from=22.76475, 121.1503&to=22.75321437727234, 121.16465302702785" target="_blank">台東美術館>國際地標</a>
                </div> -->
                <div>
                    <button onclick="onClickLocation();">取得目前座標</button>
                    <button onclick="onClickMoveCurrentLocation();">移動到目前座標</button>
                </div>
                <!-- <div class="d-flex align-items-center">
                    <p class="mb-0">移動 x, y 位置：</p><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="1">x: 50, y: 50</a><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="2">x: 100, y: 100</a><a class="js-panby m-1 btn btn-sm btn-outline-primary" href="#" data-times="3">x: 150, y: 150</a>
                </div> -->
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="map"></div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="dist/main.min.js?v=1.0.18"></script>
    <script type="text/javascript">
        var e = L.map("map", { attributionControl: !0, zoomControl: !0 });
        //固定取得自己的座標
        document.addEventListener("DOMContentLoaded", function() {
            var t = [24.9983469, 121.5810358];
            
            
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(e);
            var o = L.icon({ iconUrl: "https://letswritetw.github.io/letswrite-leaflet-osm-locate/dist/dot.svg", iconSize: [16, 16] }),
                n = L.marker(t, { icon: o, title: "跟 <a> 的 title 一樣", opacity: 1 }).addTo(e);

            function a(t) {
                var e = document.querySelectorAll(".js-panto");
                Array.prototype.forEach.call(e, function(e) {
                    e.addEventListener("click", function(e) {
                        e.preventDefault();
                        var o = e.target.dataset.to.split(","),
                            n = e.target.textContent,
                            a = document.getElementById("flyTo").checked;
                        L.popup().setLatLng(o).setContent("".concat(n)).openOn(t), a ? t.flyTo(o) : t.panTo(o);
                    });
                });
            }

            function c(t) {
                var e = document.querySelectorAll(".js-panby");
                Array.prototype.forEach.call(e, function(e) {
                    e.addEventListener("click", function(e) {
                        e.preventDefault();
                        var o = 50 * e.target.dataset.times,
                            n = [o, o];
                        t.panBy(n);
                    });
                });
            }

            //台東美術館22.76475, 121.1503
            //國際地標22.75321437727234, 121.16465302702785
            //台東火車站22.79259,121.12333
            //增加marker
            var center = [22.79259, 121.12333];
            var marker = L.marker(center, {
              title: '從目前位置導航到台東火車站', // 跟 <a> 的 title 一樣
              opacity: 1.0
            }).addTo(e);
            marker.bindPopup("<button onclick='onClickMarker(22.79259, 121.12333)'>從目前位置導航到台東火車站</button>").openPopup();

            center = [22.76475, 121.1503];
            marker = L.marker(center, {
              title: '從目前位置導航到台東美術館', // 跟 <a> 的 title 一樣
              opacity: 1.0
            }).addTo(e);
            marker.bindPopup("<button onclick='onClickMarker(22.76475, 121.1503)'>從目前位置導航到台東美術館</button>").openPopup();


            e.locate({ setView: !0, watch: false, maxZoom: 18, enableHighAccuracy: !0 }),
                e.on("locationerror", function(o) {
                    console.log("e", o), window.alert("無法判斷您的所在位置，無法使用此功能。預設地點將為 台北市動物園"), e.setView(t, 18), a(e), c(e);
                }),
                e.on("locationfound", function(t) {

                    // alert('您所在的位置經緯度' + t.latlng.lat + ',' + t.latlng.lng);
                    // console.log(t.latlng.lat);
                    // console.log(t.latlng.lng);
                    console.log("e", t), n.setLatLng(t.latlng), a(e), c(e);
                    currentLocation = t;
                });
        });

        function onClickMarker(To經度, To緯度){
          window.open(get路經規劃網址(currentLocation.latlng.lat, currentLocation.latlng.lng, To經度, To緯度), '_blank');
        }

        
        function get路經規劃網址(From經度, From緯度, To經度, To緯度){
          return "https://www.openstreetmap.org/directions?from="+From經度+", "+From緯度+"&to="+To經度+", "+To緯度+"";
        }

        function onClickMoveCurrentLocation(){
            e.flyTo([currentLocation.latlng.lat, currentLocation.latlng.lng]);
        }

        $(function(){
          // var map = L.map("map");
          

        });
    </script>
</body>

</html>